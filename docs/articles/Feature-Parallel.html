<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Features: Parallelization • SummarizedBenchmark</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Features: Parallelization">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SummarizedBenchmark</a>
        <span class="version label label-info" data-toggle="tooltip" data-placement="bottom" title="Bioc Devel">2.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SummarizedBenchmark-Introduction.html">Quick Start</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General</li>
    <li>
      <a href="../articles/SummarizedBenchmark-Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/SummarizedBenchmark-ClassDetails.html">Class Details</a>
    </li>
    <li>
      <a href="../articles/SummarizedBenchmark-FullCaseStudy.html">Full Case Study</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Features</li>
    <li>
      <a href="../articles/Feature-ErrorHandling.html">Error Handling</a>
    </li>
    <li>
      <a href="../articles/Feature-Iterative.html">Iterative Benchmarking</a>
    </li>
    <li>
      <a href="../articles/Feature-Parallel.html">Parallelization</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">More Case Studies</li>
    <li>
      <a href="../articles/CaseStudy-SingleCellSimulation.html">scRNA-seq Simulation</a>
    </li>
    <li>
      <a href="../articles/CaseStudy-RNAseqQuantification.html">RNA-seq Quantification</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/areyesq89/SummarizedBenchmark">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Features: Parallelization</h1>
                        <h4 class="author">Patrick K. Kimes, Alejandro Reyes</h4>
            
            <h4 class="date">22 June 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/areyesq89/SummarizedBenchmark/blob/master/vignettes/Feature-Parallel.Rmd"><code>vignettes/Feature-Parallel.Rmd</code></a></small>
      <div class="hidden name"><code>Feature-Parallel.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      “Running a large number of methods on several data sets, as in a benchmark comparisons can be computationaly expensive, possibly requiring hours to days to complete if each method is run in serial. Parallelization in the <code>SummarizedBenchmark</code>, both across methods and data sets can be accomplished using the <code>BiocParallel</code> package. Both forms of parallelization are demonstrated with an example case study. `SummarizedBenchmark package version: 2.3.4”
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The simple examples considered in most of these vignettes were constructed to be computational manageable with only one core. However, when working with larger data sets, running each method in serial with a single machine is often undesirable. Similarly, when replicating benchmark experiments across multiple data sets, running each experiment in serial may be inefficent. In this section, we describe how to use the <code><a href="https://www.rdocumentation.org/packages/BiocStyle/topics/macros">BiocStyle::Biocpkg("BiocParallel")</a></code> package to parallelize benchmarking across methods and data sets. More details on how to specify the parallelization back-end can be found in the <em>Introduction to BiocParallel</em> vignette for the <em><a href="https://bioconductor.org/packages/3.10/BiocParallel">BiocParallel</a></em> package.</p>
<div id="example-case-study" class="section level2">
<h2 class="hasAnchor">
<a href="#example-case-study" class="anchor"></a>Example Case Study</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"SummarizedBenchmark"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"magrittr"</span>)</a></code></pre></div>
<p>To demonstrate the use of <code><a href="../reference/updateBench.html">updateBench()</a></code>, we use the sample example of comparing methods for differential expression using the <strong>SummarizedBenchmark: Full Case Study</strong> vignette. The <em>BenchDesign</em> is initialized using RNA-seq counts and truth included with the package as an example data set. The data is described in more detail in the <strong>Case Study</strong> vignette.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"limma"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"edgeR"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"DESeq2"</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"tximport"</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(soneson2016)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">mycounts &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(txi<span class="op">$</span>counts)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">mycoldat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">condition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(mycoldat) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(mycounts)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">mydat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">coldat =</span> mycoldat, <span class="dt">cntdat =</span> mycounts,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">              <span class="dt">status =</span> truthdat<span class="op">$</span>status, <span class="dt">lfc =</span> truthdat<span class="op">$</span>logFC)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">bd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat)</a></code></pre></div>
<p>Three methods for differential expression testing implemented in the <em><a href="https://bioconductor.org/packages/3.10/DESeq2">DESeq2</a></em>, <em><a href="https://bioconductor.org/packages/3.10/edgeR">edgeR</a></em>, and <em><a href="https://bioconductor.org/packages/3.10/limma">limma</a></em> packages are added to the benchmark. Only the p-values are stored for each method, as before.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">deseq2_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData, <span class="dt">colData =</span> colData, <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    dds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="kw"><a href="https://www.rdocumentation.org/packages/DESeq2/topics/results">results</a></span>(dds, <span class="dt">contrast =</span> contrast)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">deseq2_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>pvalue }</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">edgeR_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    des &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(design)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/estimateDisp">estimateDisp</a></span>(y, des)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmFit</a></span>(y, des)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmLRT</a></span>(fit, <span class="dt">coef=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">edgeR_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>table<span class="op">$</span>PValue }</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">voom_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">    y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">    y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    des &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(design)</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">    y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/limma/topics/voom">voom</a></span>(y, des)</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">    <span class="kw"><a href="https://www.rdocumentation.org/packages/limma/topics/ebayes">eBayes</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/limma/topics/lmFit">lmFit</a></span>(y, des))</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">voom_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>p.value[, <span class="dv">2</span>] }</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">bd &lt;-<span class="st"> </span>bd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>, <span class="dt">func =</span> deseq2_run, <span class="dt">post =</span> deseq2_pv,</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb3-31" data-line-number="31">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">                                   <span class="dt">contrast =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>, <span class="dt">func =</span> edgeR_run, <span class="dt">post =</span> edgeR_pv,</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb3-35" data-line-number="35">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"voom"</span>, <span class="dt">func =</span> voom_run, <span class="dt">post =</span> voom_pv, </a>
<a class="sourceLine" id="cb3-38" data-line-number="38">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition))</a></code></pre></div>
</div>
</div>
<div id="across-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#across-methods" class="anchor"></a>Across Methods</h1>
<p>Since constructing a <em>BenchDesign</em> object requires no computation, the bottleneck only appears at the <code><a href="../reference/buildBench.html">buildBench()</a></code> step of the process. Parallelization of this step is enabled using the <em><a href="https://bioconductor.org/packages/3.10/BiocParallel">BiocParallel</a></em> package. By default, parallel evaluation is disabled, but can easily be enabled by setting <code>parallel = TRUE</code> and optionally specifying the <code>BPPARAM =</code> parameter. If <code>BPPARAM =</code> is not specified, the default back-end will be used. The default back-end can be checked with <code>bpparam()</code>.</p>
<p>Parallelization of <code><a href="../reference/buildBench.html">buildBench()</a></code> is carried out across the set of methods specified with <code><a href="../reference/addMethod.html">addMethod()</a></code>. Thus, there is no benefit to specifying more cores than the number of methods.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">bpparam</span>()</a></code></pre></div>
<pre><code>## class: MulticoreParam
##   bpisup: FALSE; bpnworkers: 2; bptasks: 0; bpjobname: BPJOB
##   bplog: FALSE; bpthreshold: INFO; bpstopOnError: TRUE
##   bpRNGseed: ; bptimeout: 2592000; bpprogressbar: FALSE
##   bpexportglobals: TRUE
##   bplogdir: NA
##   bpresultdir: NA
##   cluster type: FORK</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">sbp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">parallel =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">                  <span class="dt">BPPARAM =</span> BiocParallel<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/BiocParallel/topics/SerialParam-class">SerialParam</a></span>())</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">sbp</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 3 
## metadata(1): sessions
## assays(1): default
## rownames: NULL
## rowData names(1): default
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
<p>We also run <code><a href="../reference/buildBench.html">buildBench()</a></code> without parallelization for comparison.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">truthCols =</span> <span class="st">"status"</span>)</a></code></pre></div>
<p>The results, as expected, are the same as when <code><a href="../reference/buildBench.html">buildBench()</a></code> was called without parallelization.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(<span class="kw">assay</span>(sbp) <span class="op">==</span><span class="st"> </span><span class="kw">assay</span>(sb), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="across-datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#across-datasets" class="anchor"></a>Across Datasets</h1>
<p>Typically, benchmark studies have more than a single dataset. For this cases, users can create a <em>BenchDesign</em> object and execute this design on many datasets. Again, running the step of executing the benchmark design on every dataset using a single core might take to long. However, parallelization across datasets is possible using the <em><a href="https://bioconductor.org/packages/3.10/BiocParallel">BiocParallel</a></em> package.</p>
<p>To demonstrate this, we split the count data and ground truths of the <span class="citation">(Soneson and Robinson 2016)</span> dataset, as if they were three different datasets.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">ndat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(mydat<span class="op">$</span>status)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">spIndexes &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/split">split</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(ndat), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>( <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">length.out =</span> ndat))</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">datasetList &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(spIndexes, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">coldat =</span> mydat<span class="op">$</span>coldat, </a>
<a class="sourceLine" id="cb11-6" data-line-number="6">        <span class="dt">cntdat =</span> mydat<span class="op">$</span>cntdat[x, ], </a>
<a class="sourceLine" id="cb11-7" data-line-number="7">        <span class="dt">status =</span> mydat<span class="op">$</span>status[x], </a>
<a class="sourceLine" id="cb11-8" data-line-number="8">        <span class="dt">lfc =</span> mydat<span class="op">$</span>lfc[x])</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">})</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(datasetList) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"dataset1"</span>, <span class="st">"dataset2"</span>, <span class="st">"dataset3"</span>)</a></code></pre></div>
<p>Then, using a call to <code>bplapply()</code> function, we can execute the <em>BenchDesign</em> object for each dataset. Note that with the <code>BPPARAM =</code> parameter, the execution of the <em>BenchDesign</em> is done across many computing instances. In the example below, we use 3 cores.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">sbL &lt;-<span class="st"> </span><span class="kw">bplapply</span>(datasetList, <span class="cf">function</span>(x) { <span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">data =</span> x) },</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">                <span class="dt">BPPARAM =</span> <span class="kw">MulticoreParam</span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">sbL</a></code></pre></div>
<pre><code>## $dataset1
## class: SummarizedBenchmark 
## dim: 5226 3 
## metadata(1): sessions
## assays(1): default
## rownames: NULL
## rowData names(1): default
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx
## 
## $dataset2
## class: SummarizedBenchmark 
## dim: 5226 3 
## metadata(1): sessions
## assays(1): default
## rownames: NULL
## rowData names(1): default
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx
## 
## $dataset3
## class: SummarizedBenchmark 
## dim: 5225 3 
## metadata(1): sessions
## assays(1): default
## rownames: NULL
## rowData names(1): default
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Soneson_2016">
<p>Soneson, Charlotte, and Mark D Robinson. 2016. “iCOBRA: Open, Reproducible, Standardized and Live Method Benchmarking.” <em>Nature Methods</em> 13 (4):283–83. <a href="https://doi.org/10.1038/nmeth.3805" class="uri">https://doi.org/10.1038/nmeth.3805</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#across-methods">Across Methods</a></li>
      <li><a href="#across-datasets">Across Datasets</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://alejandroreyes.org">Alejandro Reyes</a>, <a href="https://www.pkimes.com">Patrick Kimes</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
